# Plan: Transform Inputs to Dropdowns - Cálculo de Adição

## Overview
Transform all text inputs in the calculator into dropdown selectors with a numeric scale from -25.00 to +25.00.

## Requirements (Final)
1. **Dropdown Type**: Custom dropdown with visual grouping (NO keyboard input option)
2. **Numeric Scale**: -25.00 to +25.00 (0 in center)
3. **Default Value**: 0,00 for all dropdowns
4. **Order**: Negatives above, positives below (0 in the middle)
5. **Special Rule**: Only "Adição" dropdown will have only positive numbers (0.00 to +6.00)
6. **Step Size**: 0.25 (standard optical measurement precision)
7. **Visual Style**: Orange hover effect (#f26b2b) for consistency

## Dropdown Structure for "Cálculo de Adição" Block

### Input 1: Longe (Far)
- **Current**: Text input field [`addLongeInput`](public/index.html:101)
- **New**: Dropdown with options from -25.00 to +25.00
- **Default**: 0,00
- **Total Options**: 201 values (from -25.00 to +25.00 in 0.25 steps)

### Input 2: Perto (Near)
- **Current**: Text input field [`addPertoInput`](public/index.html:117)
- **New**: Dropdown with options from -25.00 to +25.00
- **Default**: 0,00
- **Total Options**: 201 values (from -25.00 to +25.00 in 0.25 steps)

## Implementation Approach (FINAL)

### Custom Dropdown with Visual Grouping

**Selected Approach**: Custom dropdown with visual grouping (negatives/positives sections), orange hover effect.

**Features**:
- Visual separation of negative and positive value sections
- Orange hover effect (#f26b2b) for consistency with existing design
- Scrollable dropdown with fixed height
- 0,00 as default selected value
- Values ordered: negatives (top) → 0,00 (middle) → positives (bottom)
- Step size: 0.25
- Total options: 201 values

### Component Features:
1. **Visual Grouping**: Separate sections for negatives, zero, and positives
2. **Orange Hover**: #f26b2b hover effect on options
3. **Scrollable**: Fixed height dropdown with scrollbar
4. **Auto-scroll**: Automatically scroll to selected value (0,00) on open
5. **Clean UI**: Consistent with existing Tailwind design

### Visual Layout:
```
┌─────────────────────────────────┐
│ 0,00                    ▼       │  ← Display selected value
└─────────────────────────────────┘
         ↓ (on click)
┌─────────────────────────────────┐
│ ─────────────────────────────── │
│ NEGATIVOS                       │
│ ─────────────────────────────── │
│ -25,00  -24,75  -24,50         │
│ -24,25  -24,00  -23,75         │
│ ...                             │
│ -0,75   -0,50   -0,25          │
│ ─────────────────────────────── │
│ 0,00  ← (default, highlighted) │
│ ─────────────────────────────── │
│ POSITIVOS                       │
│ ─────────────────────────────── │
│ +0,25   +0,50   +0,75          │
│ +1,00   +1,25   +1,50          │
│ ...                             │
│ +24,75  +25,00                  │
└─────────────────────────────────┘
```

### HTML Structure:
```html
<div class="custom-dropdown" data-dropdown-id="addLongeInput">
    <!-- Trigger Button -->
    <button class="dropdown-trigger">
        <span class="selected-value">0,00</span>
        <span class="dropdown-arrow">▼</span>
    </button>
    
    <!-- Dropdown Menu -->
    <div class="dropdown-menu">
        <div class="dropdown-section">
            <div class="section-header">NEGATIVOS</div>
            <div class="dropdown-options">
                <!-- Options generated by JS -->
            </div>
        </div>
        <div class="dropdown-section">
            <div class="section-header">ZERO</div>
            <div class="dropdown-options">
                <option value="0.00" class="dropdown-option selected">0,00</option>
            </div>
        </div>
        <div class="dropdown-section">
            <div class="section-header">POSITIVOS</div>
            <div class="dropdown-options">
                <!-- Options generated by JS -->
            </div>
        </div>
    </div>
    
    <!-- Hidden Input for Form Submission -->
    <input type="hidden" id="addLongeInput" value="0.00">
</div>
```

### CSS Styling:
```css
.custom-dropdown {
    position: relative;
    width: 100%;
}

.dropdown-trigger {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
}

.dropdown-trigger:hover {
    border-color: #f26b2b;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    max-height: 300px;
    overflow-y: auto;
    z-index: 50;
    display: none;
}

.dropdown-menu.open {
    display: block;
}

.section-header {
    padding: 0.5rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 600;
    color: #64748b;
    background: #f1f5f9;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.dropdown-option {
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    transition: background-color 0.15s;
}

.dropdown-option:hover {
    background-color: #f26b2b;
    color: white;
}

.dropdown-option.selected {
    background-color: #f26b2b;
    color: white;
    font-weight: 500;
}
```

## JavaScript Changes Required

### 1. Generate Dropdown Options
```javascript
function generateDropdownOptions(isAddition = false) {
    const options = {
        negatives: [],
        zero: [{ value: '0.00', display: '0,00' }],
        positives: []
    };
    
    // For "Adição" dropdown, only show positive numbers from 0.00 to +6.00
    if (isAddition) {
        for (let i = 0.25; i <= 6; i += 0.25) {
            options.positives.push({
                value: i.toFixed(2),
                display: formatNumber(i)
            });
        }
    } else {
        // For other dropdowns, show full range from -25.00 to +25.00
        for (let i = -25; i < 0; i += 0.25) {
            options.negatives.push({
                value: i.toFixed(2),
                display: formatNumber(i)
            });
        }
        
        for (let i = 0.25; i <= 25; i += 0.25) {
            options.positives.push({
                value: i.toFixed(2),
                display: formatNumber(i)
            });
        }
    }
    
    return options;
}

function formatNumber(num) {
    const formatted = num.toFixed(2).replace('.', ',');
    return num >= 0 ? `+${formatted}` : formatted;
}
```

### 2. Initialize Dropdown Component
```javascript
function initDropdown(dropdownId, isAddition = false) {
    const dropdown = document.querySelector(`[data-dropdown-id="${dropdownId}"]`);
    const trigger = dropdown.querySelector('.dropdown-trigger');
    const menu = dropdown.querySelector('.dropdown-menu');
    const selectedValueSpan = dropdown.querySelector('.selected-value');
    const hiddenInput = dropdown.querySelector('input[type="hidden"]');
    
    // Generate options
    const options = generateDropdownOptions(isAddition);
    
    // Populate negative options (only if not addition dropdown)
    if (!isAddition) {
        const negativeContainer = dropdown.querySelector('.dropdown-section:nth-child(1) .dropdown-options');
        options.negatives.forEach(opt => {
            const option = document.createElement('div');
            option.className = 'dropdown-option';
            option.textContent = opt.display;
            option.dataset.value = opt.value;
            option.addEventListener('click', () => selectOption(dropdown, opt));
            negativeContainer.appendChild(option);
        });
    } else {
        // Hide negative section for addition dropdown
        const negativeSection = dropdown.querySelector('.dropdown-section:nth-child(1)');
        if (negativeSection) {
            negativeSection.style.display = 'none';
        }
    }
    
    // Populate positive options
    const positiveContainer = dropdown.querySelector('.dropdown-section:nth-child(3) .dropdown-options');
    options.positives.forEach(opt => {
        const option = document.createElement('div');
        option.className = 'dropdown-option';
        option.textContent = opt.display;
        option.dataset.value = opt.value;
        option.addEventListener('click', () => selectOption(dropdown, opt));
        positiveContainer.appendChild(option);
    });
    
    // Toggle dropdown
    trigger.addEventListener('click', () => {
        menu.classList.toggle('open');
        if (menu.classList.contains('open')) {
            // Scroll to selected value
            const selectedOption = menu.querySelector('.dropdown-option.selected');
            if (selectedOption) {
                selectedOption.scrollIntoView({ block: 'nearest' });
            }
        }
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
            menu.classList.remove('open');
        }
    });
    
    // Select default value (0,00)
    selectOption(dropdown, options.zero[0]);
}

function selectOption(dropdown, option) {
    const selectedValueSpan = dropdown.querySelector('.selected-value');
    const hiddenInput = dropdown.querySelector('input[type="hidden"]');
    const menu = dropdown.querySelector('.dropdown-menu');
    
    // Update selected value display
    selectedValueSpan.textContent = option.display;
    
    // Update hidden input
    hiddenInput.value = option.value;
    
    // Update selected class
    dropdown.querySelectorAll('.dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    const selectedOption = dropdown.querySelector(`.dropdown-option[data-value="${option.value}"]`);
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
    
    // Close dropdown
    menu.classList.remove('open');
    
    // Trigger change event
    hiddenInput.dispatchEvent(new Event('change', { bubbles: true }));
}
```

### 3. Update Event Handlers
- Replace `input` event listeners with `change` event listeners
- Update value parsing to work with dropdown values
- Maintain calculation logic (no changes needed to formula)

### 4. Initialize All Dropdowns
```javascript
document.addEventListener('DOMContentLoaded', () => {
    // Cálculo de Adição block (both inputs have full range -25.00 to +25.00)
    initDropdown('addLongeInput', false);  // Longe: full range
    initDropdown('addPertoInput', false);  // Perto: full range
    
    // Cálculo de Perto block (Adição input: 0.00 to +6.00 only)
    initDropdown('nearLongeInput', false);  // Longe: full range
    initDropdown('nearAddInput', true);     // Adição: positive only (0.00 to +6.00)
    
    // Cálculo de Longe block (Adição input: 0.00 to +6.00 only)
    initDropdown('farPertoInput', false);   // Perto: full range
    initDropdown('farAddInput', true);      // Adição: positive only (0.00 to +6.00)
});
```

## Implementation Steps (FINAL)

### Phase 1: Cálculo de Adição Block (Current Scope)
1. ✅ Analyze current structure
2. ✅ Design dropdown component with visual grouping
3. ✅ Create detailed implementation plan
4. ⏳ Switch to Code mode to implement
5. ⏳ Add CSS styling for custom dropdown (orange hover effect)
6. ⏳ Implement JavaScript for dropdown behavior
7. ⏳ Replace "Longe" input (line 101) with custom dropdown (full range -25.00 to +25.00)
8. ⏳ Replace "Perto" input (line 117) with custom dropdown (full range -25.00 to +25.00)
9. ⏳ Update calculation event handlers (change instead of input)
10. ⏳ Test functionality in "Cálculo de Adição" block
11. ⏳ Get user approval before proceeding to other blocks

### Phase 2: Cálculo de Perto Block (Future)
- Replace "Longe" input with custom dropdown (full range -25.00 to +25.00)
- Replace "Adição" input with custom dropdown (positive only 0.00 to +6.00)

### Phase 3: Cálculo de Longe Block (Future)
- Replace "Perto" input with custom dropdown (full range -25.00 to +25.00)
- Replace "Adição" input with custom dropdown (positive only 0.00 to +6.00)

## Files to Modify

1. **public/index.html**:
   - Replace input elements at lines 101-106 (Longe input)
   - Replace input elements at lines 117-122 (Perto input)
   - Add CSS styles for custom dropdown
   - Add JavaScript for dropdown initialization and behavior

## Key Changes Summary

### HTML Changes:
- Replace `<input>` elements with custom dropdown structure
- Add hidden input for form value storage
- Add dropdown trigger button and menu

### CSS Changes:
- Add styles for `.custom-dropdown`, `.dropdown-trigger`, `.dropdown-menu`
- Add orange hover effect (#f26b2b) on `.dropdown-option:hover`
- Add section headers styling

### JavaScript Changes:
- Add `generateDropdownOptions()` function
- Add `initDropdown()` function
- Add `selectOption()` function
- Update event listeners from `input` to `change`
- Initialize dropdowns on DOMContentLoaded

## Next Steps

Once approved, I will switch to Code mode to implement the dropdown component for the "Cálculo de Adição" block.
